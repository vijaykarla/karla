!function(){function a(){b()}function b(){x=new Date(peptrack.EventTime),t=[{Latitude:peptrack.Latidue,Longitude:peptrack.Longitude,EventTime:peptrack.EventTime,TrackId:peptrack.TrackId,GroundSpeed:peptrack.GroundSpeed}],f(),g(),i(),clearTimeout(q),clearTimeout(r),clearTimeout(s),c(),u=new pepMap(peptrack.Latidue,peptrack.Longitude),u.initialize();var a=document.getElementById("pep-distance").getContext("2d");v=new odometer(a,{height:25,digits:4,decimals:1,value:z,wobbleFactor:0});var b=document.getElementById("pep-altitude").getContext("2d");w=new odometer(b,{height:25,digits:4,decimals:1,value:B,wobbleFactor:0})}function c(){var a=new Date(peptrack.EventTime);d(a.toUTCString()),q=setTimeout(function(){e()},y)}function d(a){var b=peptrack.DomainName+"api/"+peptrack.ApiVersion+"/data/locations/id/"+peptrack.TrackId+"?trackdate="+a+"&direction=back-1&token="+peptrack.Token;""!=peptrack.PrivateCode&&(b+="&code="+peptrack.PrivateCode),jQuery.ajax({headers:{Accept:"application/json; charset=utf-8","Content-Type":"application/json; charset=utf-8"},url:b,type:"GET",contentType:"application/json; charset=utf-8",success:function(a){if(a&&void 0!=a&&a.length>0){var b=new Date(a[0].EventTime);if(void 0==x||x.getTime()!=b.getTime()){var c=a[0];c&&c.Latitude&&c.Longitude&&(t.length>1&&t.splice(1,1),t.unshift(c),k(!1))}}},error:function(a,b,c){},timeout:y})}function e(){var a=peptrack.DomainName+"api/"+peptrack.ApiVersion+"/data/location/id/"+peptrack.TrackId+"?token="+peptrack.Token;""!=peptrack.PrivateCode&&(a+="&code="+peptrack.PrivateCode),jQuery.ajax({headers:{Accept:"application/json; charset=utf-8","Content-Type":"application/json; charset=utf-8"},url:a,type:"GET",contentType:"application/json; charset=utf-8",success:function(a){if(a&&a.Latitude&&a.Longitude){var b=[parseFloat(a.Latitude),parseFloat(a.Longitude)],c=new Date(a.EventTime);if(void 0==x||x.getTime()!=c.getTime()){peptrack.Latidue=a.Latitude,peptrack.Longitude=a.Longitude,peptrack.EventTime=a.EventTime,t.length>1&&t.splice(0,1),t.push(a),l(A,!0),k(!0),l(A,!1),f(),E=0,g(),i();var d=parseFloat(a.Elevation);0==C&&0!=d?n(d+15,!0):n(C,!0),0!=d?(peptrack.Elevation=d,C=d,n(d,!1)):(peptrack.Elevation=D,C=D,n(D,!1)),clearTimeout(pepMap.markerTimeout),u.transition(b)}x=c}},error:function(a,b,c){},timeout:y}),q=setTimeout(function(){e()},y)}function f(){var a={weekday:"long",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"};$("#pep-date").html(x.toLocaleString("en-us",a))}function g(){if(t.length>0){currentlocation=t[t.length-1];var a=currentlocation.Latitude,b=currentlocation.Longitude;if(t.length>1){var c=t[t.length-2],d=(c.Latitude,c.Longitude,j(t[t.length-2],t[t.length-1]));if(d<.01)return}var e=peptrack.DomainName+"api/"+peptrack.ApiVersion+"/data/address?latitude="+a+"&longitude="+b+"&token="+peptrack.Token;jQuery.ajax({headers:{Accept:"application/json; charset=utf-8","Content-Type":"application/json; charset=utf-8"},url:e,type:"GET",contentType:"application/json; charset=utf-8",success:function(a){if(a){E=0;var b=a.Address,c=a.Province,d=a.Country,e=parseFloat(a.Distance);a.Elevation&&null!=a.Elevation&&(D=parseFloat(a.Elevation));var f="";if(e>1e3){var h=e/1e3;h=h.toFixed(1),f=h+" Km"}else f=Math.round(e)+" metres";var i=f+" away from<br/>";i+=b+"<br/>",void 0!=c&&(i+=c+"<br/>"),void 0!=d&&(i+=d);var b='<span style="font-weight: bold; color:red">'+f+" away from:</span>";b+='<br/><span style="color:#6600cc;">'+a.Address,"Unknown"!=a.Province&&(b+="<br/>"+a.Province),void 0!=a.PostalCode&&(b+=" "+a.PostalCode),"Unknown"!=a.Country&&(b+="<br/>"+a.Country),b+="</span>",$("#pep-address").show(),$("#pep-address").html(b)}else E<5&&(E++,g())},error:function(a,b,c){E<5&&(E++,g())},timeout:y})}}function h(a){var b=$(".selected");return b.removeClass("selected"),a.addClass("selected"),i(),!1}function i(){if(t.length>0){var a=$(".selected"),b=a.attr("data-location"),c=b.split(","),d={Latitude:parseFloat(c[0]),Longitude:parseFloat(c[1])},e=j(t[t.length-1],d);if(F<0&&(F=e),F>0){var f=100-Math.round(e/F*100);f<=100&&f>0&&$(".divpointer").css({left:f.toString()+"%"})}else 0==F?$(".divpointer").css({left:"99%"}):F<0&&$(".divpointer").css({left:"0%"});initDist=e;var g="";if(e>1){var h=e.toFixed(1);g=h+" Km"}else g=Math.round(1e3*e)+" metres";g+=" away from ";var i=a.html();$("#spndistance").html(g),$("#spnpoit").html(i)}}function j(a,b){var c=6371,d=(b.Latitude-a.Latitude)*Math.PI/180,e=(b.Longitude-a.Longitude)*Math.PI/180,f=Math.sin(d/2)*Math.sin(d/2)+Math.cos(a.Latitude*Math.PI/180)*Math.cos(b.Latitude*Math.PI/180)*Math.sin(e/2)*Math.sin(e/2),g=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),h=c*g;return h}function k(a){null==G&&(G=new Gauge("pep-speed",{mode:"needle",range:{min:0,max:180}}));var b=0;if(t.length>1){b=Math.round(parseFloat(t[t.length-1].GroundSpeed));var c,d,e;c=t[t.length-1],d=t[t.length-2];var e=j(c,d);if(e>=0){var f=new Date(c.EventTime),g=new Date(d.EventTime),h=f-g;if(h>0){var i=h/1e3/60/60;0==b&&(b=Math.round(e/i)),a&&(i<8?A+=e:A=0)}}}else t.length>0&&(b=Math.round(parseFloat(t[t.length-1].GroundSpeed)));b||(b=0),peptrack.GroundSpeed=b,b>=0&&b<=180?G.draw(b):b<0?G.draw(0):b>180&&G.draw(180)}function l(a,b){b?(clearTimeout(r),z=a):z+=.005,z>a&&(z=a),v.setValue(z),z<a&&(r=setTimeout(function(){l(a,b)},100))}function m(){clearTimeout(r),A=0,z=0,l(0,!0)}function n(a,b){b?(H=0,clearTimeout(s),B=a):a>B?B+=.01:a<B&&(B-=.01),w.setValue(B);var c=a-B;(c<-.02||c>.02)&&(H++,H>1500&&(H=0,clearTimeout(s),B=a),s=setTimeout(function(){n(a,b)},10))}function o(){$("#pointpopup").hide(),$("#overlay").hide()}function p(){$("#pointpopup").on("click","a",function(a){var b=$(a.target);h(b)})}var q,r,s,t,u,v,w,x=void 0,y=16e3,z=0,A=0,B=peptrack.Elevation,C=B,D=0,E=0;window.onfocus=a;var F=-1,G=null,H=0;$(document).ready(function(){$("#divhouse").click(function(){}),$("#spnpoit").click(function(){}),$("#spndistance").click(function(){}),$("#overlay").click(function(){o()}),$("#imgreset").click(function(){m()}),p(),b()})}();
